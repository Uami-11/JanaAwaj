<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JanaAwaj – Live Reports</title>

  <!-- Dark mode + system preference -->
  <script>
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    }
  </script>

  <!-- Tailwind CDN (instant beautiful styling) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { colors: { primary: '#dc2626' } } }
    }
  </script>

  <!-- Nepali Font -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Nepali:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', 'Noto Sans Nepali', sans-serif; }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 min-h-screen py-12 transition-colors">

  <div class="max-w-7xl mx-auto px-6">
    <header class="bg-white dark:bg-gray-800 shadow-lg rounded-2xl p-8 mb-10 text-center relative">
      <h1 id="pageTitle" class="text-5xl font-bold text-primary mb-3">JanaAwaj Live Tracker</h1>
      <p id="pageDesc" class="text-xl text-gray-600 dark:text-gray-300">Real-time public reports from Nepal</p>
      <a href="/" class="inline-block mt-6 text-primary font-semibold hover:underline">← Submit New Report</a>

      <div id="adminBadge" class="hidden absolute top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold animate-pulse">
        ADMIN MODE ACTIVE
      </div>
    </header>

    <div id="adminNotice" class="hidden mb-6 p-4 bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-700 rounded-lg text-center">
      <p class="font-semibold text-yellow-800 dark:text-yellow-200">
        You are in Admin Mode — You can edit status or delete reports
      </p>
      <button onclick="exitAdmin()" class="mt-2 text-sm underline">Exit Admin Mode</button>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-3xl shadow-2xl overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-100 dark:bg-gray-700">
            <tr>
              <th class="px-8 py-5 text-left text-sm font-semibold text-gray-700 dark:text-gray-200 uppercase tracking-wider" data-t="subject">Subject</th>
              <th class="px-8 py-5 text-left text-sm font-semibold text-gray-700 dark:text-gray-200 uppercase tracking-wider" data-t="category">Category</th>
              <th class="px-8 py-5 text-sm font-semibold text-gray-700 dark:text-gray-200 uppercase tracking-wider" data-t="status">Status</th>
              <th class="px-8 py-5 text-left text-sm font-semibold text-gray-700 dark:text-gray-200 uppercase tracking-wider" data-t="files">Files</th>
              <th class="px-8 py-5 text-left text-sm font-semibold text-gray-700 dark:text-gray-200 uppercase tracking-wider" data-t="submitted">Submitted</th>
              <th id="adminHeader" class="hidden px-8 py-5 text-sm font-semibold text-gray-700 dark:text-gray-200 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody id="reportsTable" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
        </table>
      </div>
      <div id="noReports" class="text-center py-20 text-2xl text-gray-500 dark:text-gray-400">
        No reports yet. Be the first to raise your voice!
      </div>
    </div>
  </div>

  <!-- Language Toggle + Keyboard Layout (bottom-left) -->
  <div class="fixed bottom-5 left-5 z-50 flex items-center gap-4 bg-white dark:bg-gray-800 p-4 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700">
    <button id="langBtn" onclick="toggleLang()" class="px-5 py-2.5 bg-primary text-white rounded-lg font-bold hover:bg-red-700 transition">
      नेपाली
    </button>
    <a href="https://applyvr.election.gov.np/Image/nepali-unicode-romanized-v1.4-main-window-outlook.jpg" target="_blank" class="flex items-center gap-2 text-primary hover:underline font-medium">
      <img src="https://applyvr.election.gov.np/Image/nepali-unicode-romanized-v1.4-main-window-outlook.jpg" alt="Nepali Keyboard" class="w-8 h-8 rounded border">
      Keyboard Layout
    </a>
  </div>

  <script>
    const t = {
      en: {
        pageTitle: "JanaAwaj Live Tracker",
        pageDesc: "Real-time public reports from Nepal",
        subject: "Subject",
        category: "Category",
        status: "Status",
        files: "Files",
        submitted: "Submitted",
        noReports: "No reports yet. Be the first to raise your voice!",
        submittedStatus: "Submitted",
        inProgress: "In Progress",
        resolved: "Resolved",
        delete: "Delete",
        confirmDelete: "Are you sure you want to delete this report?",
        adminNotice: "You are in Admin Mode — You can edit status or delete reports",
        exitAdmin: "Exit Admin Mode"
      },
      ne: {
        pageTitle: "जनआवाज लाइभ ट्रयाकर",
        pageDesc: "नेपालका जनताबाट रियल-टाइम रिपोर्टहरू",
        subject: "शीर्षक",
        category: "श्रेणी",
        status: "स्थिति",
        files: "फाइलहरू",
        submitted: "पेश गरिएको",
        noReports: "अहिलेसम्म कुनै रिपोर्ट छैन। पहिलो आवाज उठाउनुहोस्!",
        submittedStatus: "पेश गरिएको",
        inProgress: "प्रगतिमा",
        resolved: "समाधान गरिएको",
        delete: "मेटाउनुहोस्",
        confirmDelete: "के तपाईं यो रिपोर्ट मेटाउन निश्चित हुनुहुन्छ?",
        adminNotice: "तपाईं एडमिन मोडमा हुनुहुन्छ — तपाईं स्थिति परिवर्तन गर्न वा रिपोर्ट मेटाउन सक्नुहुन्छ",
        exitAdmin: "एडमिन मोडबाट बाहिरिनुहोस्"
      }
    };

    let lang = localStorage.getItem('lang') || 'en';

    const urlParams = new URLSearchParams(window.location.search);
    const isAdmin = urlParams.get('admin') === 'true';

    function applyLang() {
      document.documentElement.lang = lang;
      document.getElementById('pageTitle').textContent = t[lang].pageTitle;
      document.getElementById('pageDesc').textContent = t[lang].pageDesc;
      document.getElementById('noReports').textContent = t[lang].noReports;
      document.querySelectorAll('[data-t]').forEach(el => {
        el.textContent = t[lang][el.dataset.t];
      });
      document.getElementById('langBtn').textContent = lang === 'en' ? 'नेपाली' : 'English';
      if (isAdmin) {
        document.querySelector('#adminNotice p').textContent = t[lang].adminNotice;
        document.querySelector('#adminNotice button').textContent = t[lang].exitAdmin;
      }
      loadReports();
    }

    function toggleLang() {
      lang = lang === 'en' ? 'ne' : 'en';
      localStorage.setItem('lang', lang);
      applyLang();
    }

    function exitAdmin() {
      window.location.href = '/reports' + (lang === 'ne' ? '?lang=ne' : '');
    }

    function saveReports(reports) {
      localStorage.setItem('janaawajReports', JSON.stringify(reports));
    }

    function loadReports() {
      const reports = JSON.parse(localStorage.getItem('janaawajReports') || '[]');
      const tbody = document.getElementById('reportsTable');
      const noReports = document.getElementById('noReports');

      tbody.innerHTML = '';

      if (reports.length === 0) {
        noReports.style.display = 'block';
        return;
      }
      noReports.style.display = 'none';

      reports.forEach((r, i) => {
        const tr = document.createElement('tr');
        tr.className = 'hover:bg-gray-50 dark:hover:bg-gray-700 transition';

        const statusOpts = {
          'Submitted': t[lang].submittedStatus,
          'In Progress': t[lang].inProgress,
          'Resolved': t[lang].resolved
        };

        const statusColors = {
          'Submitted': 'bg-yellow-100 text-yellow-800',
          'In Progress': 'bg-blue-100 text-blue-800',
          'Resolved': 'bg-green-100 text-green-800'
        };

        tr.innerHTML = `
          <td class="px-8 py-5 font-medium text-gray-900 dark:text-white">${r.subject || '—'}</td>
          <td class="px-8 py-5 text-gray-600 dark:text-gray-300">${r.category}</td>
          <td class="px-8 py-5">
            ${isAdmin ? `
              <select onchange="updateStatus(${i}, this.value)" class="px-3 py-1.5 rounded-lg font-bold text-sm border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800">
                <option value="Submitted" ${r.status==='Submitted'?'selected':''}>${t[lang].submittedStatus}</option>
                <option value="In Progress" ${r.status==='In Progress'?'selected':''}>${t[lang].inProgress}</option>
                <option value="Resolved" ${r.status==='Resolved'?'selected':''}>${t[lang].resolved}</option>
              </select>
            ` : `
              <span class="px-3 py-1.5 rounded-full text-xs font-bold ${statusColors[r.status] || 'bg-gray-100 text-gray-800'}">
                ${statusOpts[r.status] || r.status}
              </span>
            `}
          </td>
          <td class="px-8 py-5 text-gray-600 dark:text-gray-300">${r.filesCount > 0 ? r.filesCount + ' file(s)' : '—'}</td>
          <td class="px-8 py-5 text-gray-500 dark:text-gray-400 text-sm">${r.timestamp}</td>
          <td class="${isAdmin ? '' : 'hidden'} px-8 py-5">
            <button onclick="deleteReport(${i})" class="text-red-600 hover:text-red-800 font-medium text-sm">
              ${t[lang].delete}
            </button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function updateStatus(i, val) {
      const reports = JSON.parse(localStorage.getItem('janaawajReports') || '[]');
      reports[i].status = val;
      saveReports(reports);
      loadReports();
    }

    function deleteReport(i) {
      if (confirm(t[lang].confirmDelete)) {
        const reports = JSON.parse(localStorage.getItem('janaawajReports') || '[]');
        reports.splice(i, 1);
        saveReports(reports);
        loadReports();
      }
    }

    // Init
    if (isAdmin) {
      document.getElementById('adminBadge').classList.remove('hidden');
      document.getElementById('adminNotice').classList.remove('hidden');
      document.getElementById('adminHeader').classList.remove('hidden');
    }

    applyLang();
    setInterval(loadReports, 8000);
  </script>
</body>
</html>